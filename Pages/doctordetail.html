<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/doctordetail.css">
</head>

<body>
    <header class="header" id="header">
    </header>
    <div class="main-wrapper">
        <div class="container">
            <img id="img" alt="watch"><br>
            <div class="product-div">

                <div class="product-div-left">

                    <div class="img-container">

                        <div class="docname"><span id="name" class="doctor-name"></span><br>
                            <span id="edu" class="doctor-price"></span>
                        </div>
                        <p class="doctor-description" id="para">

                        </p>


                    </div>
                </div>
                <div class="product-div-right">

                    <label class="lab">Select a date: </label>
                    <input type="date" id="dateInput" onchange="validateDate(this)">

                    <label class="lab">Timeslot:</label><span id="rate" class="doctor-hos"></span>

                </div>
            </div>
        </div>
    </div>


    <script>
        function validateDate(input) {
            const selectedDate = moment(input.value);
            const currentDate = moment();
            const threeDaysLater = moment().add(3, 'days');

            if (selectedDate.isBefore(currentDate, 'day')) {
                alert('Please select a future date');
                input.value = ''; // Clear the input value if it's invalid
            } else if (selectedDate.isAfter(threeDaysLater, 'day')) {
                alert('You can only select dates within the next 3 days');
                input.value = ''; // Clear the input value if it's invalid
            } else {
                // Perform further actions if the date is valid
            }
        }



        let details_url = window.location.search
        let urlparams = new URLSearchParams(details_url)
        let geturl = urlparams.get("doc_id")
        // console.log(geturl);


        let user_url = window.location.search
        let params = new URLSearchParams(user_url)
        let get_user = params.get("user_id")
        console.log(get_user);

        let details = JSON.parse(window.localStorage.getItem("doctor"))
        console.log(details);


        let appoint = JSON.parse(localStorage.getItem("appointmentdetails"))
        let doc_detail = details.find(function (doc_object) {
            let doc_user = doc_object["doctor_id"]

            if (geturl == doc_user) {
                return true;
            }
        })

        let docdetail;
        if (appoint != null) {
            for (let i = 0; i < appoint.length; i++) {
                docdetail = appoint.filter(function (doc_object) {
                    let doc_user = doc_object["Docid"]
                    console.log(doc_user);

                    if (geturl == doc_user) {
                        return true;
                    }
                })
                console.log(docdetail)
            }

        }




        let images = document.getElementById("img")
        images.setAttribute("src", doc_detail["doctor_img"])
        let name = document.getElementById("name")
        name.innerText = doc_detail["name"]
        let rate = document.getElementById("rate")

        // rate.innerHTML = doc_detail["docslot"]
        let edu = document.getElementById("edu")
        edu.innerText = doc_detail["special"]
        let paras = document.getElementById("para")
        paras.innerText = doc_detail["bio"]




        const startTime = doc_detail["docslot"];
        const endTime = doc_detail["doctorendtime"];

        const startHour = parseInt(startTime.split(":")[0]);
        const endHour = parseInt(endTime.split(":")[0]);
        const doctorID = "1"
        const currentDate = new Date();
        const currentDateString = currentDate.toISOString().slice(0, 10);


        for (let hour = startHour; hour < endHour; hour++) {
            for (let minute = 0; minute < 60; minute += 30) {
                // Calculate the start and end times for the current 30-minute interval
                // if (docdetail[i]["Docid"] == geturl && docdetail[i]["slotID"] == slotID)
                const intervalStart = new Date();
                intervalStart.setHours(hour);
                intervalStart.setMinutes(minute);
                const intervalEnd = new Date(intervalStart);
                intervalEnd.setMinutes(intervalEnd.getMinutes() + 30);

                // Format the start and end times for the current interval
                const startString = intervalStart.toLocaleTimeString([], { timeStyle: "short" });
                const endString = intervalEnd.toLocaleTimeString([], { timeStyle: "short" });
                const slotID = `slot_${currentDateString}_${doctorID}_${startString}-${endString}`;

                // Create a new button element with a unique ID and text content
                const slotBtn = document.createElement("button");
                slotBtn.setAttribute("id", slotID);
                slotBtn.setAttribute("class", "btn");
                slotBtn.setAttribute("onclick", "tym(this.id)")
                slotBtn.innerText = `${startString} - ${endString}`;

                // Append the button to the rate container element
                rate.append(slotBtn);
            }
        }

        function tym(id) {
            let date = document.getElementById("dateInput").value
            let obj = {
                id, date
            }
            window.localStorage.setItem("timeslotid", JSON.stringify(obj))
            window.location.href = "../Pages/bookapp.html?doc_id=" + doc_detail["doctor_id"]

        }


        // console.log(docdetail)

        // if (docdetail[i]["Docid"] == geturl && docdetail[i]["slotID"] == slotID)
        let b = document.getElementsByClassName("btn")
        console.log(b)
        let idArr = []
        for (let i = 0; i < b.length; i++) {
            let c = b[i].getAttribute("id");
            idArr.push(c)

        }
        console.log(idArr);

        for (let i = 0; i < idArr.length; i++) {
            for (let j = 0; j < docdetail.length; j++) {
                if (idArr[i] == docdetail[j]["slotID"]) {
                    let button = document.getElementById(idArr[i]);
                    button.style.color = "grey";
                    button.disabled = true;
                    button.style.cursor = 'not-allowed';
                }
            }
        }




    </script>

    <script src="../assets/js/script.js">
    </script>


    <script src="../components/header.js">

    </script>

    <script>
        nav_head()
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

</body>

</html>